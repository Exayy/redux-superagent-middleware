{"version":3,"sources":["webpack:///webpack/universalModuleDefinition","webpack:///webpack/bootstrap 6a9a46d9c252256243b1","webpack:///./src/index.js","webpack:///external \"superagent\""],"names":["customConfig","config","superagentMiddleware","base","defaultHeaders","hooks","goTo","action","store","next","payload","meta","console","error","res","dispatch","getState","responseHandler","response","requestFailed","body","httpCode","status","request","cancelled","requestActions","Array","requests","map","requestAction","url","method","headers","params","defaultParams","onRequest","onStart","promiseList","push","Promise","superagentRequest","query","set","send","end","err","resolve","cancel","all","then","responses","interrupted","hadError","finalPayload","finalMeta","index","test","onFailure","onError","name","onSuccess","onComplete"],"mappings":"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","file":"library.js","sourcesContent":["(function webpackUniversalModuleDefinition(root, factory) {\n\tif(typeof exports === 'object' && typeof module === 'object')\n\t\tmodule.exports = factory(require(\"superagent\"));\n\telse if(typeof define === 'function' && define.amd)\n\t\tdefine([\"superagent\"], factory);\n\telse if(typeof exports === 'object')\n\t\texports[\"library\"] = factory(require(\"superagent\"));\n\telse\n\t\troot[\"library\"] = factory(root[\"superagent\"]);\n})(this, function(__WEBPACK_EXTERNAL_MODULE_1__) {\nreturn \n\n\n// WEBPACK FOOTER //\n// webpack/universalModuleDefinition"," \t// The module cache\n \tvar installedModules = {};\n\n \t// The require function\n \tfunction __webpack_require__(moduleId) {\n\n \t\t// Check if module is in cache\n \t\tif(installedModules[moduleId])\n \t\t\treturn installedModules[moduleId].exports;\n\n \t\t// Create a new module (and put it into the cache)\n \t\tvar module = installedModules[moduleId] = {\n \t\t\texports: {},\n \t\t\tid: moduleId,\n \t\t\tloaded: false\n \t\t};\n\n \t\t// Execute the module function\n \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n \t\t// Flag the module as loaded\n \t\tmodule.loaded = true;\n\n \t\t// Return the exports of the module\n \t\treturn module.exports;\n \t}\n\n\n \t// expose the modules object (__webpack_modules__)\n \t__webpack_require__.m = modules;\n\n \t// expose the module cache\n \t__webpack_require__.c = installedModules;\n\n \t// __webpack_public_path__\n \t__webpack_require__.p = \"\";\n\n \t// Load entry module and return exports\n \treturn __webpack_require__(0);\n\n\n\n// WEBPACK FOOTER //\n// webpack/bootstrap 6a9a46d9c252256243b1","import superagent from \"superagent\"\n\nlet config = {\n    base : \"\",\n    defaultHeaders : {\n        \"Content-Type\" : \"application/json\",\n    },\n    hooks : {},\n}\n\nfunction goTo(action, store, next, payload, meta) {\n\n    if (typeof action !== \"function\"){\n        /* eslint-disable no-console */\n        console.error(\"superagentMiddleware error : onStart, onSuccess, onError, onComplete must be functions\");\n        /* eslint-enable no-console */\n        return\n    }\n\n    const res = action(payload, meta, store.dispatch, store.getState)\n    res && next(res)\n}\n\nfunction responseHandler(response) {\n\n    if (!response) {\n        return { error : true, meta : { requestFailed : true } }\n    }\n\n    const res = { \n        error : true,\n        payload : response.body,\n        meta : {\n            httpCode : response.status,\n        },\n    }\n    if (response.status <= 300) {\n        res.error = false\n    }\n\n    return res\n}\n\nconst superagentMiddleware = store => next => action => {\n\n    if (!action.request){\n        return next(action)\n    }\n\n    // Cancelled status\n    let cancelled = false\n\n    // Requests configuration\n    const requestActions = action.request instanceof Array ? action.request : [action.request]\n    const requests = requestActions.map(requestAction => {\n        let request = {\n            base : requestAction.base || config.base,\n            url : requestAction.url,\n            method : requestAction.method || \"GET\",\n            headers : { ...config.defaultHeaders, ...(requestAction.headers || {}) },\n            params : { ...config.defaultParams, ...(requestAction.params || {}) },\n            body : requestAction.body,\n        }\n\n        if (config.hooks.onRequest) {\n            request = config.hooks.onRequest(store, action, request) || request\n        }\n\n        return request\n    })\n\n    // Requests execution\n    action.onStart && goTo(action.onStart, store, next)\n    const promiseList = []\n    requests.map(request => {\n        promiseList.push(new Promise(resolve => {\n            const superagentRequest = superagent(request.method, request.base + request.url)\n            request.params && superagentRequest.query(request.params)\n            request.headers && superagentRequest.set(request.headers)\n            request.body && superagentRequest.send(request.body)\n            superagentRequest.end((err, response) => {\n                resolve(response)\n            })\n        }))\n    })\n\n    // Define cancel in action\n    action.cancel = () => {\n        cancelled = true\n    }\n\n    // Handling responses\n    Promise.all(promiseList).then((responses) => {\n\n        if (cancelled) {\n            return\n        }\n\n        let interrupted = false\n        let hadError = false\n        let finalPayload = {}\n        let finalMeta = {}\n        responses.map((response, index) => {\n            const test = responseHandler(response)\n\n            if ((test.meta.requestFailed && config.hooks.onFailure && config.hooks.onFailure(store, action, requestActions[index], response) === false) ||\n                (test.error && config.hooks.onError && config.hooks.onError(store, action, requestActions[index], response) === false)) {\n                interrupted = true\n            }\n            if (test.error === true) {\n                hadError = true\n            }\n\n            if (!(action.request instanceof Array)){\n                finalPayload = test.payload,\n                finalMeta = test.meta\n            } else {\n                const name = requestActions[index].name || \"request_\" + index\n                finalPayload[name] = test.payload\n                finalMeta[name] = test.meta\n            }\n        })\n\n        if (!interrupted) {\n            !hadError && action.onSuccess && goTo(action.onSuccess, store, next, finalPayload, finalMeta)\n            hadError && action.onError && goTo(action.onError, store, next, finalPayload, finalMeta)\n        }\n        action.onComplete && goTo(action.onComplete, store, next)\n    })\n}\n\nexport default function(customConfig){\n    config = {...config, ...customConfig}\n    return superagentMiddleware\n}\n\n\n\n// WEBPACK FOOTER //\n// ./src/index.js","module.exports = __WEBPACK_EXTERNAL_MODULE_1__;\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"superagent\"\n// module id = 1\n// module chunks = 0"],"sourceRoot":""}