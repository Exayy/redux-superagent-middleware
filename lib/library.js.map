{"version":3,"sources":["webpack:///webpack/universalModuleDefinition","webpack:///webpack/bootstrap a38e218a730e56d7f6dc","webpack:///./src/index.js","webpack:///external \"superagent\""],"names":["customConfig","config","superagentMiddleware","base","defaultHeaders","hooks","goTo","action","store","next","payload","meta","console","error","res","dispatch","getState","responseHandler","response","requestFailed","body","httpCode","status","request","cancelled","requestActions","Array","requests","map","requestAction","undefined","url","method","headers","params","defaultParams","onRequest","onStart","promiseList","push","Promise","superagentRequest","query","set","send","end","err","resolve","cancel","all","then","responses","interrupted","hadError","finalPayload","finalMeta","index","test","onFailure","onError","name","onSuccess","onComplete"],"mappings":"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","file":"library.js","sourcesContent":["(function webpackUniversalModuleDefinition(root, factory) {\n\tif(typeof exports === 'object' && typeof module === 'object')\n\t\tmodule.exports = factory(require(\"superagent\"));\n\telse if(typeof define === 'function' && define.amd)\n\t\tdefine([\"superagent\"], factory);\n\telse if(typeof exports === 'object')\n\t\texports[\"library\"] = factory(require(\"superagent\"));\n\telse\n\t\troot[\"library\"] = factory(root[\"superagent\"]);\n})(this, function(__WEBPACK_EXTERNAL_MODULE_1__) {\nreturn \n\n\n// WEBPACK FOOTER //\n// webpack/universalModuleDefinition"," \t// The module cache\n \tvar installedModules = {};\n\n \t// The require function\n \tfunction __webpack_require__(moduleId) {\n\n \t\t// Check if module is in cache\n \t\tif(installedModules[moduleId])\n \t\t\treturn installedModules[moduleId].exports;\n\n \t\t// Create a new module (and put it into the cache)\n \t\tvar module = installedModules[moduleId] = {\n \t\t\texports: {},\n \t\t\tid: moduleId,\n \t\t\tloaded: false\n \t\t};\n\n \t\t// Execute the module function\n \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n \t\t// Flag the module as loaded\n \t\tmodule.loaded = true;\n\n \t\t// Return the exports of the module\n \t\treturn module.exports;\n \t}\n\n\n \t// expose the modules object (__webpack_modules__)\n \t__webpack_require__.m = modules;\n\n \t// expose the module cache\n \t__webpack_require__.c = installedModules;\n\n \t// __webpack_public_path__\n \t__webpack_require__.p = \"\";\n\n \t// Load entry module and return exports\n \treturn __webpack_require__(0);\n\n\n\n// WEBPACK FOOTER //\n// webpack/bootstrap a38e218a730e56d7f6dc","import superagent from \"superagent\"\n\nlet config = {\n    base : \"\",\n    defaultHeaders : {\n        \"Content-Type\" : \"application/json\",\n    },\n    hooks : {},\n}\n\nfunction goTo(action, store, next, payload, meta) {\n\n    if (typeof action !== \"function\"){\n        /* eslint-disable no-console */\n        console.error(\"superagentMiddleware error : onStart, onSuccess, onError, onComplete must be functions\");\n        /* eslint-enable no-console */\n        return\n    }\n\n    const res = action(payload, meta, store.dispatch, store.getState)\n    res && next(res)\n}\n\nfunction responseHandler(response) {\n\n    if (!response) {\n        return { error : true, meta : { requestFailed : true } }\n    }\n\n    const res = { \n        error : true,\n        payload : response.body,\n        meta : {\n            httpCode : response.status,\n        },\n    }\n    if (response.status <= 300) {\n        res.error = false\n    }\n\n    return res\n}\n\nconst superagentMiddleware = store => next => action => {\n\n    if (!action.request){\n        return next(action)\n    }\n\n    // Cancelled status\n    let cancelled = false\n\n    // Requests configuration\n    const requestActions = action.request instanceof Array ? action.request : [action.request]\n    const requests = requestActions.map(requestAction => {\n        let request = {\n            base : requestAction.base !== undefined ? requestAction.base : config.base,\n            url : requestAction.url,\n            method : requestAction.method || \"GET\",\n            headers : { ...config.defaultHeaders, ...(requestAction.headers || {}) },\n            params : { ...config.defaultParams, ...(requestAction.params || {}) },\n            body : requestAction.body,\n        }\n\n        if (config.hooks.onRequest) {\n            request = config.hooks.onRequest(store, action, request) || request\n        }\n\n        return request\n    })\n\n    // Requests execution\n    action.onStart && goTo(action.onStart, store, next)\n    const promiseList = []\n    requests.map(request => {\n        promiseList.push(new Promise(resolve => {\n            const superagentRequest = superagent(request.method, request.base + request.url)\n            request.params && superagentRequest.query(request.params)\n            request.headers && superagentRequest.set(request.headers)\n            request.body && superagentRequest.send(request.body)\n            superagentRequest.end((err, response) => {\n                resolve(response)\n            })\n        }))\n    })\n\n    // Define cancel in action\n    action.cancel = () => {\n        cancelled = true\n    }\n\n    // Handling responses\n    Promise.all(promiseList).then((responses) => {\n\n        if (cancelled) {\n            return\n        }\n\n        let interrupted = false\n        let hadError = false\n        let finalPayload = {}\n        let finalMeta = {}\n        responses.map((response, index) => {\n            const test = responseHandler(response)\n\n            if ((test.meta.requestFailed && config.hooks.onFailure && config.hooks.onFailure(store, action, requestActions[index], response) === false) ||\n                (test.error && config.hooks.onError && config.hooks.onError(store, action, requestActions[index], response) === false)) {\n                interrupted = true\n            }\n            if (test.error === true) {\n                hadError = true\n            }\n\n            if (!(action.request instanceof Array)){\n                finalPayload = test.payload,\n                finalMeta = test.meta\n            } else {\n                const name = requestActions[index].name || \"request_\" + index\n                finalPayload[name] = test.payload\n                finalMeta[name] = test.meta\n            }\n        })\n\n        if (!interrupted) {\n            !hadError && action.onSuccess && goTo(action.onSuccess, store, next, finalPayload, finalMeta)\n            hadError && action.onError && goTo(action.onError, store, next, finalPayload, finalMeta)\n        }\n        action.onComplete && goTo(action.onComplete, store, next)\n    })\n}\n\nexport default function(customConfig){\n    config = {...config, ...customConfig}\n    return superagentMiddleware\n}\n\n\n\n// WEBPACK FOOTER //\n// ./src/index.js","module.exports = __WEBPACK_EXTERNAL_MODULE_1__;\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"superagent\"\n// module id = 1\n// module chunks = 0"],"sourceRoot":""}